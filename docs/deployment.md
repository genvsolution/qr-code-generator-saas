# Deployment Guide for QR Code Genius

This document provides detailed instructions and best practices for deploying the 'QR Code Genius' application to a production environment. It covers server setup, application configuration, containerization, web server setup, and securing the application with HTTPS.

## Table of Contents

1.  [Introduction](#1-introduction)
2.  [Deployment Environment Prerequisites](#2-deployment-environment-prerequisites)
3.  [Core Deployment Strategy](#3-core-deployment-strategy)
4.  [Step-by-Step Deployment Guide](#4-step-by-step-deployment-guide)
    *   [4.1. Server Setup](#41-server-setup)
    *   [4.2. Prepare Application Files](#42-prepare-application-files)
    *   [4.3. Configure Environment Variables](#43-configure-environment-variables)
    *   [4.4. Database Initialization](#44-database-initialization)
    *   [4.5. Build and Run Docker Containers](#45-build-and-run-docker-containers)
    *   [4.6. Nginx Configuration](#46-nginx-configuration)
    *   [4.7. Secure with HTTPS (Certbot)](#47-secure-with-https-certbot)
    *   [4.8. Final Checks](#48-final-checks)
5.  [Environment Variables Reference](#5-environment-variables-reference)
6.  [Persistent Storage and Backups](#6-persistent-storage-and-backups)
7.  [Logging and Monitoring](#7-logging-and-monitoring)
8.  [Maintenance and Updates](#8-maintenance-and-updates)
9.  [Troubleshooting Common Issues](#9-troubleshooting-common-issues)

---

## 1. Introduction

Deploying 'QR Code Genius' involves setting up a robust, scalable, and secure environment. This guide outlines a recommended production deployment strategy using Docker for containerization, Gunicorn as the WSGI server, PostgreSQL for the database, and Nginx as a reverse proxy with SSL termination.

## 2. Deployment Environment Prerequisites

Before you begin, ensure your production server meets the following requirements:

*   **Operating System**: A recent Linux distribution (e.g., Ubuntu 20.04 LTS or newer, Debian 11+).
*   **Docker & Docker Compose**: Installed and configured.
    *   [Install Docker Engine](https://docs.docker.com/engine/install/)
    *   [Install Docker Compose](https://docs.docker.com/compose/install/)
*   **Nginx**: Installed.
    *   `sudo apt update && sudo apt install nginx`
*   **Certbot**: Installed (for automated SSL certificate management).
    *   `sudo apt install certbot python3-certbot-nginx`
*   **Domain Name**: A registered domain name pointing to your server's public IP address (e.g., `qrgenius.com`). Ensure DNS `A` records are correctly configured.
*   **Firewall**: A configured firewall (e.g., UFW) allowing SSH (port 22), HTTP (port 80), and HTTPS (port 443) traffic.

## 3. Core Deployment Strategy

Our recommended deployment strategy leverages containerization for isolation, portability, and ease of management:

*   **Application Container**: The Flask application runs within a Docker container, served by Gunicorn.
*   **Database Container**: PostgreSQL runs in its own Docker container, ensuring data persistence through Docker volumes.
*   **Reverse Proxy**: Nginx acts as a reverse proxy, forwarding requests to the application container. It also handles SSL/TLS termination and serves static files directly.
*   **HTTPS Enforcement**: All traffic is secured using HTTPS, managed by Nginx and Certbot.
*   **Environment Variables**: Sensitive configuration (database credentials, secret keys) is passed to containers via environment variables.
*   **Persistent Volumes**: Docker volumes are used to store PostgreSQL data and generated QR code images, ensuring data is not lost when containers are recreated.

## 4. Step-by-Step Deployment Guide

Follow these steps to deploy 'QR Code Genius' to your production server.

### 4.1. Server Setup

1.  **Update System**:
    bash
    sudo apt update && sudo apt upgrade -y
    
2.  **Install Docker & Docker Compose**: Follow the official Docker documentation links provided in the [Prerequisites](#2-deployment-environment-prerequisites) section.
    *   Add your user to the `docker` group to run Docker commands without `sudo`:
        bash
        sudo usermod -aG docker $USER
        # Log out and log back in for the changes to take effect
        
3.  **Install Nginx**:
    bash
    sudo apt install nginx -y
    
4.  **Install Certbot**:
    bash
    sudo apt install certbot python3-certbot-nginx -y
    
5.  **Configure Firewall (UFW)**:
    bash
    sudo ufw allow OpenSSH
    sudo ufw allow 'Nginx HTTP'
    sudo ufw allow 'Nginx HTTPS' # Will be needed after Certbot config
    sudo ufw enable
    sudo ufw status
    

### 4.2. Prepare Application Files

1.  **Clone the Repository**: On your production server, clone the 'QR Code Genius' repository.
    bash
    git clone https://github.com/your-org/qr-code-genius.git /opt/qr-code-genius
    cd /opt/qr-code-genius
    
    *(Replace `https://github.com/your-org/qr-code-genius.git` with your actual repository URL)*

2.  **Verify Dockerfile and docker-compose.yml**: Ensure your project root contains a `Dockerfile` for the Flask application and a `docker-compose.yml` file to orchestrate the services.

    *   **Example `Dockerfile` (conceptual):**
        dockerfile
        # Dockerfile
        FROM python:3.9-slim-buster

        WORKDIR /app

        COPY requirements.txt .
        RUN pip install --no-cache-dir -r requirements.txt

        COPY . .

        # Gunicorn configuration
        ENV FLASK_APP=app.py
        ENV FLASK_ENV=production
        ENV PYTHONUNBUFFERED=1

        # Expose the port Gunicorn will listen on
        EXPOSE 8000

        # Command to run Gunicorn
        CMD ["gunicorn", "-w", "4", "-b", "0.0.0.0:8000", "app:create_app()"]
        
        *(Assuming `app.py` has a `create_app()` factory function, or adjust `app:app` if using a global `app` instance.)*

    *   **Example `docker-compose.yml` (conceptual):**
        yaml
        # docker-compose.yml
        version: '3.8'

        services:
          db:
            image: postgres:13-alpine
            restart: always
            environment:
              POSTGRES_DB: ${POSTGRES_DB}
              POSTGRES_USER: ${POSTGRES_USER}
              POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
            volumes:
              - pgdata:/var/lib/postgresql/data
            env_file:
              - .env

          app:
            build: .
            restart: always
            ports:
              - "8000:8000" # Expose Gunicorn port for Nginx to connect
            environment:
              DATABASE_URL: postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:5432/${POSTGRES_DB}
              SECRET_KEY: ${SECRET_KEY}
              QR_CODE_STORAGE_PATH: /app/qr_codes_storage # Path inside container
            volumes:
              - qr_codes_data:/app/qr_codes_storage # Persistent storage for QR codes
              - ./static:/app/static # Mount static files for Nginx to serve
            depends_on:
              - db
            env_file:
              - .env

        volumes:
          pgdata:
          qr_codes_data:
        

### 4.3. Configure Environment Variables

Create a `.env` file in the root of your project directory (`/opt/qr-code-genius/.env`). This file will hold sensitive configuration and will be used by `docker-compose`.

ini
# .env file
# Application Configuration
FLASK_APP=app.py
FLASK_ENV=production
SECRET_KEY=YOUR_VERY_LONG_AND_RANDOM_SECRET_KEY_HERE # Use a strong, unique key
DOMAIN_NAME=qrgenius.com # Your domain name

# Database Configuration (for PostgreSQL container)
POSTGRES_DB=qrgenius_db
POSTGRES_USER=qrgenius_user
POSTGRES_PASSWORD=YOUR_STRONG_DB_PASSWORD

# QR Code Storage
QR_CODE_STORAGE_PATH=/app/qr_codes_storage # Path inside the Docker container for QR images

**Important**:
*   Replace `YOUR_VERY_LONG_AND_RANDOM_SECRET_KEY_HERE` with a truly random and complex string (e.g., generated by `python -c 'import os; print(os.urandom(24))'`).
*   Replace `YOUR_STRONG_DB_PASSWORD` with a strong, unique password for the database.
*   Ensure `DOMAIN_NAME` matches your actual domain.

### 4.4. Database Initialization

Before starting the application, ensure the database schema is created and up-to-date. This typically involves running Flask-Migrate commands.

1.  **Start the database service only**:
    bash
    docker-compose up -d db
    
2.  **Wait for DB to be ready**: Give the PostgreSQL container a moment to fully initialize. You can check its logs: `docker-compose logs db`.
3.  **Run Migrations**: Execute Flask-Migrate commands from within the application container.
    bash
    docker-compose run --rm app flask db upgrade
    
    *This command temporarily runs a new `app` container, executes the migration, and then removes the container. This ensures the database schema is applied.*

### 4.5. Build and Run Docker Containers

Now, build your application image and start all services defined in `docker-compose.yml`.

1.  **Build Images**:
    bash
    docker-compose build
    
    This will build the `app` image based on your `Dockerfile` and pull the `postgres` image.
2.  **Start Services**:
    bash
    docker-compose up -d
    
    This command starts all services (`db` and `app`) in detached mode.
3.  **Verify Containers**: Check if containers are running correctly:
    bash
    docker-compose ps
    docker-compose logs app # Check application logs for errors
    
    You should see `qr-code-genius-db-1` and `qr-code-genius-app-1` (or similar names) in a `running` state.

### 4.6. Nginx Configuration

Nginx will act as the public-facing web server, forwarding requests to your Gunicorn-served Flask application and serving static files.

1.  **Create Nginx Configuration File**:
    bash
    sudo nano /etc/nginx/sites-available/qrgenius.com
    
    Replace `qrgenius.com` with your actual domain name.

2.  **Add Nginx Configuration**:
    nginx
    server {
        listen 80;
        server_name qrgenius.com www.qrgenius.com; # Replace with your domain

        location /static/ {
            alias /opt/qr-code-genius/static/; # Path to your static files on the host
            expires 30d;
            add_header Cache-Control "public, no-transform";
        }

        location / {
            proxy_pass http://localhost:8000; # Or http://127.0.0.1:8000 if your app container is mapped to host port 8000
            # If you are using a Docker network and Nginx is on the host,
            # you might need to use the Docker container's IP or map the port.
            # For simplicity, if docker-compose.yml has `ports: - "8000:8000"`,
            # then localhost:8000 is correct.
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_redirect off;
        }
    }
    
    **Note on `proxy_pass`**: If your `docker-compose.yml` does *not* expose port `8000` to the host (i.e., no `ports: - "8000:8000"` mapping), and Nginx is running directly on the host, you'll need to configure Nginx to resolve the Docker container's IP or use a Docker network for Nginx. For simplicity, the example `docker-compose.yml` above *does* map port `8000`, so `http://localhost:8000` is correct.

3.  **Create a Symlink**: Enable the Nginx configuration by creating a symlink to `sites-enabled`.
    bash
    sudo ln -s /etc/nginx/sites-available/qrgenius.com /etc/nginx/sites-enabled/
    

4.  **Test Nginx Configuration**:
    bash
    sudo nginx -t
    
    Ensure there are no syntax errors.

5.  **Reload Nginx**:
    bash
    sudo systemctl reload nginx
    
    At this point, you should be able to access your application via `http://qrgenius.com` (though it's not yet secured with HTTPS).

### 4.7. Secure with HTTPS (Certbot)

Use Certbot to automatically obtain and configure SSL certificates from Let's Encrypt.

1.  **Run Certbot**:
    bash
    sudo certbot --nginx -d qrgenius.com -d www.qrgenius.com
    
    *   Follow the prompts. Certbot will automatically modify your Nginx configuration to include SSL settings and set up automatic certificate renewal.
    *   Choose to redirect HTTP traffic to HTTPS when prompted.

2.  **Verify Nginx Configuration**: Certbot will have updated your `/etc/nginx/sites-available/qrgenius.com` file. You can inspect it to see the added SSL directives.
    bash
    sudo nginx -t
    sudo systemctl reload nginx
    

3.  **Test Auto-Renewal**:
    bash
    sudo certbot renew --dry-run
    
    This command simulates the renewal process to ensure it works correctly.

### 4.8. Final Checks

1.  **Access Application**: Open your web browser and navigate to `https://qrgenius.com`. Verify that the site loads correctly and that the connection is secure (look for the padlock icon).
2.  **Test Functionality**:
    *   Register a new user.
    *   Log in.
    *   Generate a QR code.
    *   Download a QR code.
    *   Check your dashboard.
    *   Ensure all links and static assets load correctly.
3.  **Check Logs**: Monitor the application and Nginx logs for any errors.
    bash
    docker-compose logs app
    sudo journalctl -u nginx -f
    

## 5. Environment Variables Reference

Here's a list of critical environment variables used by the 'QR Code Genius' application:

| Variable                | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   